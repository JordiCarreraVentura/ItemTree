
#	Overview

This script takes as input a collection of records and sorts them into a tree-like structure. The tree is generated by recursively splitting the collection into two partitions. The split in each partition is based on the highest frequency item across all the members in that partition. All members containing an occurrence of that item are placed into one subclass and all other items are put into the other.

## Example
For illustration, consider the following output:

```
pbpaste | awk '{gsub("\\. ", ".\n", $0); print}' | python ItemTree.py --min_size 1 --preproc word_normal
The tree is generated by recursively splitting the collection into two partitions.	./is/by/the
The split in each partition is by the highest frequency item across all the members in that partition.	./is/by/the
This script takes as input a collection of records and sorts them according to a tree-like structure.	./*
```

## Invocation

The script can be invoked with the following command:
`python ItemTree.py PATH/TO/INPUT/FILE PATH/TO/OUTPUT/FILE`

The input and output file parameters are optional; if they are not provided, the script will read from the standard input (`sys.stdin` in Python). When invoked this way, the script can be used in a BASH pipeline as shown in the example above (run on a Mac, vid. https://stackoverflow.com/questions/264395/linux-equivalent-of-the-mac-os-x-open-command).

### Optional parameters

| Parameter | Flag | Type | Description |
|---|---|---|---|
|Input file location | | positional, optional | A file for the script to read input from. If no argument is not provided, the script will both read input from and write output to the terminal. Notice that no output file can be specified without specifying an input file (if only one file is specified, the script will interpret it as an input file). |
|Output file location | | positional, optional | A file for the script to write output to. See also the previous point. |
|Maximum frequency| `--max_freq` | optional | Maximum frequency of any item to be used as a node in the tree. |
|Maximum probability| `--max_prob` | optional | Maximum probability of any item to be used as a node in the tree. |
|Minimum frequency| `--min_freq` | optional | Minimum frequency of any item to be used as a node in the tree. |
|Minimum probability|  `--min_prob`| optional | Minimum probability of any item to be used as a node in the tree. |
|Preprocessing method| `--preproc` | optional | Data preprocessing: `word_normal, whitespace, non_alpha, non_alnum`. `word_normal` = lowercase and tokenize, keep only numbers or words; `whitespace` = split on whitespace ; `non_alpha` = keep words only (no lowercasing) ; `non_alnum` = keep words or numbers (no lowercasing) |
|Minimum cluster size| `--min_size` | optional | Minimum size for a tree branch to be returned. |
|Maximum cluster size| `--max_size` | optional | Maximum size for a tree branch to be returned. |
|Return item trees as strings instead of feature tuples| `--itemtext` | optional | Return tree items as text instead of text/None tuples. |
|Leave output in the same order as in the original input| `--nosort` | optional | Disable automatic sorting according to item tree.|
|Output format| `--output` | optional | Output format: `'xy'` = input strings + item trees; `'yx'` = item trees + input strings; `'x'` = input strings; `'y'` = item trees`|

### Advanced usage

If the **ItemTree.py** class is used as a module and imported into another class, an object of this class can be called on the input stream. Afterwards, the same object can be iterated over in order to retrieve the sorted records. Given the whole dataset of input records X and a correlative list Y where the i-th element is the tree corresponding to the i-th element from X as generated by this script, then the default output format returns O, where
![Alt text](http://chart.apis.google.com/chart?cht=tx&chl=O%20%3D%20%5B%20(x_i%2C%20y_i)%2C%20(x_%7B(i%2B1)%7D)%2C%20y_%7B(i%20%2B%201)%7D)%5Ctext%7B%2C%20%20.%20.%20.%20%2C%20%20%7D(x_%7B%7CX%7C%7D%2C%20y_%7B%7CX%7C%7D)%5D)

Note that the order of the elements in the input is not necessarily kept in the output. More formally, while it still holds that, for the i-th element in O, its y-component is the tree corresponding to its x-component, it does not follow that a particular x (O's i-th item) is **also** X's i-th element. Actually, the opposite will normally be true unless the flag `--nosort` is used when invoking the script.


## Technical details

### Determinism
The algorithm is deterministic (as opposed to [LDA](https://en.wikipedia.org/wiki/Latent_dirichlet_allocation "Latent Dirichlet Allocation") or [k-means clustering](https://en.wikipedia.org/wiki/Kmeans)): given the same input and the same parameters, the script will produce the same output.

### Speed
Depending on the parameterization, the script can sort 8 Mb of raw text in ~180 seconds.


## Dependencies
* argparse
* csv
* re
* sys
* tqdm

